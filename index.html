<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Premium Commission Calculator</title>
  <style>
    body {
      background: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 520px;
      margin: 0 auto;
      padding: 24px;
    }
    h1 {
      font-size: 1.3em;
      text-align: center;
      margin-bottom: 10px;
      color: #c2185b;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 12px;
    }
    .input-row {
      display: flex;
      gap: 12px;
    }
    .input-col {
      flex: 1;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      margin-bottom: 8px;
      font-size: 1em;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #fff;
    }
    .button-row {
      display: flex;
      gap: 12px;
      margin-top: 18px;
      margin-bottom: 4px;
    }
    .side-btn {
      background: #1976d2;
      color: #fff;
      font-size: 1em;
      border: none;
      padding: 10px;
      width: 50%;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .side-btn:hover {
      background: #0d47a1;
    }
    .calc-btn {
      background: #388e3c;
      color: #fff;
      font-size: 1em;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .calc-btn:hover {
      background: #2e7031;
    }
    .result {
      background: #e8f5e9;
      color: #388e3c;
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      border: 2px solid #388e3c;
    }
    .breakdown-box {
      background: #f5f5f5;
      color: #333;
      font-size: 0.97em;
      margin-top: 10px;
      padding: 14px;
      border-radius: 7px;
      border: 1px solid #bbb;
      overflow-x: auto;
    }
    .breakdown-table {
      width: 100%;
      border-collapse: collapse;
    }
    .breakdown-table th, .breakdown-table td {
      border: 1px solid #ddd;
      padding: 6px 8px;
      text-align: center;
    }
    .breakdown-table th {
      background: #e0e0e0;
      font-weight: bold;
    }
    .breakdown-table tr:last-child td {
      font-weight: bold;
      background: #eee;
    }
     .tier-text {
      font-size: 1.07em;
      color: #222;
      font-weight: bold;
      margin-bottom: 10px;
      margin-top: 0;
      text-align: center;
    }
    .section-title {
      font-size: 1.1em;
      margin-top: 16px;
      margin-bottom: 6px;
      color: #333;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Premium Commission Calculator</h1>

    <form id="premiumForm" autocomplete="off">

      <div class="section-title">Premium Categories</div>

      <div class="input-row">
        <div class="input-col">
          <label for="pcPremium">P&C Premium</label>
          <input type="number" id="pcPremium" required min="0" step="0.01" placeholder="e.g. 25000">
        </div>
        <div class="input-col">
          <label for="lhPremium">Life & Health Premium</label>
          <input type="number" id="lhPremium" required min="0" step="0.01" placeholder="e.g. 300">
        </div>
      </div>

      <div class="input-row">
        <div class="input-col">
          <label for="premiumChargeback">Premium Chargeback</label>
          <input type="number" id="premiumChargeback" min="0" step="0.01" placeholder="e.g. 500">
        </div>
        <div class="input-col">
          <!-- Empty column for layout alignment -->
        </div>
      </div>

      <div class="button-row">
        <button type="button" class="side-btn" onclick="resetForm()">Reset</button>
        <button type="button" class="side-btn" onclick="clearForm()">Clear</button>
      </div>
      <button type="button" class="calc-btn" onclick="calculateCommission()">Calculate</button>
    </form>

    <div id="result" class="result" style="display:none;"></div>
    <div id="breakdown" class="breakdown-box" style="display:none;"></div>
  </div>

  <script>
    // P&C Premium Tiers
    const pcTiers = [
      {min: 0, max: 9999.99, percent: 0},
      {min: 10000, max: 19999.99, percent: 1},
      {min: 20000, max: 29999.99, percent: 2},
      {min: 30000, max: 39999.99, percent: 3},
      {min: 40000, max: 49999.99, percent: 4},
      {min: 50000, max: Infinity, percent: 5}  // 5% for $50k+
    ];

    // Life & Health Premium Tiers
    const lhTiers = [
      {min: 0, max: 99.99, percent: 0},
      {min: 100, max: 199.99, percent: 1},
      {min: 200, max: 299.99, percent: 2},
      {min: 300, max: 399.99, percent: 3},
      {min: 400, max: 499.99, percent: 4},
      {min: 500, max: Infinity, percent: 5}  // 5% for $500+
    ];

    // Load saved values from localStorage on page load
    window.addEventListener('DOMContentLoaded', function() {
      loadFromStorage();
    });

    // Save input values to localStorage
    function saveToStorage() {
      const pcPremium = document.getElementById('pcPremium').value;
      const lhPremium = document.getElementById('lhPremium').value;
      const premiumChargeback = document.getElementById('premiumChargeback').value;
      
      localStorage.setItem('pcPremium', pcPremium);
      localStorage.setItem('lhPremium', lhPremium);
      localStorage.setItem('premiumChargeback', premiumChargeback);
    }

    // Load input values from localStorage
    function loadFromStorage() {
      const pcPremium = localStorage.getItem('pcPremium');
      const lhPremium = localStorage.getItem('lhPremium');
      const premiumChargeback = localStorage.getItem('premiumChargeback');
      
      if (pcPremium !== null) document.getElementById('pcPremium').value = pcPremium;
      if (lhPremium !== null) document.getElementById('lhPremium').value = lhPremium;
      if (premiumChargeback !== null) document.getElementById('premiumChargeback').value = premiumChargeback;
    }

    // Add event listeners to save on input change
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('pcPremium').addEventListener('input', saveToStorage);
      document.getElementById('lhPremium').addEventListener('input', saveToStorage);
      document.getElementById('premiumChargeback').addEventListener('input', saveToStorage);
    });

    function getTierPercent(amount, tiers) {
      for (let i = 0; i < tiers.length; i++) {
        if (amount >= tiers[i].min && amount <= tiers[i].max) {
          return tiers[i].percent;
        }
      }
      return 0; // Default to 0% if no tier matches (should not happen with Infinity in top tier)
    }

    function getTierDescription(amount, tiers) {
      for (let i = 0; i < tiers.length; i++) {
        if (amount >= tiers[i].min && amount <= tiers[i].max) {
          const minFormatted = tiers[i].min.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
          if (tiers[i].max === Infinity) {
            return `$${minFormatted}+`;
          }
          const maxFormatted = tiers[i].max.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
          return `$${minFormatted} - $${maxFormatted}`;
        }
      }
      return "No Tier Found"; // Default (should not happen with Infinity in top tier)
    }

    // Reset button - clears ALL inputs
    function resetForm() {
      document.getElementById('pcPremium').value = '';
      document.getElementById('lhPremium').value = '';
      document.getElementById('premiumChargeback').value = '';
      document.getElementById('result').style.display = "none";
      document.getElementById('breakdown').style.display = "none";
      
      // Clear localStorage
      localStorage.removeItem('pcPremium');
      localStorage.removeItem('lhPremium');
      localStorage.removeItem('premiumChargeback');
    }

    // Clear button - only clears P&C Premium and Life & Health Premium
    function clearForm() {
      document.getElementById('pcPremium').value = '';
      document.getElementById('lhPremium').value = '';
      document.getElementById('result').style.display = "none";
      document.getElementById('breakdown').style.display = "none";
      
      // Update localStorage
      localStorage.removeItem('pcPremium');
      localStorage.removeItem('lhPremium');
    }

    function calculateCommission() {
      // Get input values
      const pcPremium = parseFloat(document.getElementById('pcPremium').value) || 0;
      const lhPremium = parseFloat(document.getElementById('lhPremium').value) || 0;
      const premiumChargeback = parseFloat(document.getElementById('premiumChargeback').value) || 0;

      // Calculate adjusted premium (P&C Premium - Premium Chargeback)
      const adjustedPremium = pcPremium - premiumChargeback;

      // Get tier percentages for each category
      const pcPercent = getTierPercent(pcPremium, pcTiers);
      const lhPercent = getTierPercent(lhPremium, lhTiers);

      // Calculate combined rate (sum of individual rates)
      const combinedRate = pcPercent + lhPercent;

      // Get tier descriptions
      const pcTierDesc = getTierDescription(pcPremium, pcTiers);
      const lhTierDesc = getTierDescription(lhPremium, lhTiers);

      // Calculate total commission using combined rate on adjusted premium
      const totalCommission = (adjustedPremium * combinedRate) / 100;

      // Display result
      document.getElementById('result').style.display = "block";
      document.getElementById('result').innerHTML = `
        <div>Total Commission:</div>
        <div style="font-size:2em;">$${totalCommission.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
      `;

      // Breakdown table
      let breakdownHTML = `<table class="breakdown-table"><thead><tr>
        <th>Category</th>
        <th>Premium</th>
        <th>Tier</th>
        <th>Rate</th>
      </tr></thead><tbody>`;
      
      breakdownHTML += `<tr>
        <td>P&C</td>
        <td>$${pcPremium.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
        <td>${pcTierDesc}</td>
        <td>${pcPercent}%</td>
      </tr>`;
      
      breakdownHTML += `<tr>
        <td>Life & Health</td>
        <td>$${lhPremium.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
        <td>${lhTierDesc}</td>
        <td>${lhPercent}%</td>
      </tr>`;
      
      breakdownHTML += `<tr>
        <td colspan="2"><strong>Combined Rate</strong></td>
        <td colspan="2"><strong>${combinedRate}%</strong></td>
      </tr>`;

      breakdownHTML += `<tr>
        <td colspan="2"><strong>P&C Premium (Base)</strong></td>
        <td colspan="2"><strong>$${pcPremium.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
      </tr>`;

      breakdownHTML += `<tr>
        <td colspan="2"><strong>Premium Chargeback</strong></td>
        <td colspan="2"><strong>$${premiumChargeback.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
      </tr>`;

      breakdownHTML += `<tr>
        <td colspan="2"><strong>Adjusted Premium</strong></td>
        <td colspan="2"><strong>$${adjustedPremium.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
      </tr>`;
      
      breakdownHTML += `<tr>
        <td colspan="3"><strong>TOTAL COMMISSION</strong></td>
        <td><strong>$${totalCommission.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
      </tr>`;
      
      breakdownHTML += `</tbody></table>`;
      
      document.getElementById('breakdown').style.display = "block";
      document.getElementById('breakdown').innerHTML = breakdownHTML;
    }
  </script>
</body>
</html>
